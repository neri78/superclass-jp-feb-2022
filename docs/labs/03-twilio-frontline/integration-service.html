<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Integration Serviceの設定 | Superclassハンズオンラボ</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/superclass-jp-feb-2022/assets/css/0.styles.9f610bb8.css" as="style"><link rel="preload" href="/superclass-jp-feb-2022/assets/js/app.a35e8044.js" as="script"><link rel="preload" href="/superclass-jp-feb-2022/assets/js/2.1599b906.js" as="script"><link rel="preload" href="/superclass-jp-feb-2022/assets/js/7.4ce9bd8d.js" as="script"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/10.3543cbf0.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/11.e9bce804.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/12.78544031.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/13.1871cdee.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/14.479a9754.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/15.7c28645a.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/16.a842cfc9.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/17.d354ae09.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/18.9f77088b.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/19.dc4207d2.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/20.393ff37b.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/21.bd602903.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/22.b60ea96d.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/23.2113c36f.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/3.5154e823.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/4.0b4b00c5.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/5.6658676b.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/6.e095efd2.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/8.d7c18c68.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/9.dc4001cc.js">
    <link rel="stylesheet" href="/superclass-jp-feb-2022/assets/css/0.styles.9f610bb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/superclass-jp-feb-2022/" class="home-link router-link-active"><!----> <span class="site-name">Superclassハンズオンラボ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/superclass-jp-feb-2022/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/superclass-jp-feb-2022/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/superclass-jp-feb-2022/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/superclass-jp-feb-2022/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Twilio Functionsの活用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>匿名通話の実現</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Twilio Frontlineの体験</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/superclass-jp-feb-2022/labs/03-twilio-frontline/" aria-current="page" class="sidebar-link">Twilio Frontlineの体験 - はじめに</a></li><li><a href="/superclass-jp-feb-2022/labs/03-twilio-frontline/twilio-frontline.html" class="sidebar-link">Twilio Frontlineの利用</a></li><li><a href="/superclass-jp-feb-2022/labs/03-twilio-frontline/sso.html" class="sidebar-link">Oktaを使用したSSOの設定</a></li><li><a href="/superclass-jp-feb-2022/labs/03-twilio-frontline/integration-service.html" aria-current="page" class="active sidebar-link">Integration Serviceの設定</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/03-twilio-frontline/integration-service.html#顧客リストの取得" class="sidebar-link">顧客リストの取得</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/03-twilio-frontline/integration-service.html#サンプルの再起動とトンネリング" class="sidebar-link">サンプルの再起動とトンネリング</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/03-twilio-frontline/integration-service.html#音声通話を有効化" class="sidebar-link">音声通話を有効化</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/03-twilio-frontline/integration-service.html#twilio-frontlineをインストールし、テストを実施" class="sidebar-link">Twilio Frontlineをインストールし、テストを実施</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="integration-serviceの設定"><a href="#integration-serviceの設定" class="header-anchor">#</a> Integration Serviceの設定</h1> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>Twilio Frontlineを利用する場合、アカウントが<a href="https://www.twilio.com/docs/iam/organizations" target="_blank" rel="noopener noreferrer">Organization<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>に属している必要があります。この機能は組織内において複数のユーザーやアカウントを管理できる機能となります。ただし、現時点で一度作成したOrganizationは <strong>コンソールから削除できません。</strong> 削除する場合はサポートへの問い合わせが必要となるため、Organizationの使用有無や使用可能が判断できない場合は、ハンズオンを実施せずにデモをご確認ください。</p> <p>また、Twilio FrontlineはTwilio Flexで利用されているプロジェクトでは利用できません。 さらに、内部ではTwilio ConversationsやTwiML Appsなどを活用しています。そのため、既存のTwilioアカウントでTwilio Frontlineを設定した場合、もともとの設定が変更されてしまう可能性があります。できるだけ新しいアカウント、あるいはサブアカウントでハンズオンを実施してください。</p> <p>Twilio Frontlineはテキストチャットが初期の機能として実装され、その後音声通話に対応しました。そのため、接続するTwilio番号はSMS、音声両方の機能に対応している必要があります。2022年2月現在、コンソールから購入可能な日本の番号はSMSに対応していないため、米国番号でハンズオンを実施してください。</p></div> <p>Twilio Frontlineを利用する場合、シングルサインオン（SSO）の設定や、CRMと連携するバックエンドアプリケーションを構築する必要があります。今回のハンズオンは<a href="https://www.twilio.com/docs/frontline/nodejs-demo-quickstart" target="_blank" rel="noopener noreferrer">Twilio Frontline Node.js Quickstart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>に沿って設定します。</p> <p><strong>目次</strong></p><div class="table-of-contents"><ul><li><a href="#顧客リストの取得">顧客リストの取得</a></li><li><a href="#サンプルの再起動とトンネリング">サンプルの再起動とトンネリング</a></li><li><a href="#音声通話を有効化">音声通話を有効化</a></li><li><a href="#twilio-frontlineをインストールし、テストを実施">Twilio Frontlineをインストールし、テストを実施</a></li></ul></div><p></p> <h2 id="顧客リストの取得"><a href="#顧客リストの取得" class="header-anchor">#</a> 顧客リストの取得</h2> <p>Frontline Integration ServiceはCRMやデータベースに存在する連絡先情報を取得し、Frontlineで使用できるように加工する機能を担っています。サンプルでは実際にデータベースに接続するのではなく、サンプル連絡先を定義します。<code>/src/providers/customers.js</code>を開き、36行目の<code>customers</code>配列を次のように設定します。顧客の名前やemail、smsを受け取る番号については適宜変更してください。
また、Frontlineでは1人の顧客に対して1ユーザーを事前に割り当てます。<code>workder</code>には先ほどOktaでアプリケーションに追加したユーザーのメールアドレスを追加します。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> customers <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
         <span class="token literal-property property">customer_id</span><span class="token operator">:</span> <span class="token number">98</span><span class="token punctuation">,</span>
         <span class="token literal-property property">display_name</span><span class="token operator">:</span> <span class="token string">'Twilio 太郎'</span><span class="token punctuation">,</span>
         <span class="token literal-property property">channels</span><span class="token operator">:</span> <span class="token punctuation">[</span>
             <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'twilio-taro@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'sms'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'+123456789'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token literal-property property">details</span><span class="token operator">:</span><span class="token punctuation">{</span>
             <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Information&quot;</span><span class="token punctuation">,</span>
             <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;Status: Active&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\n\n&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;Score: 100&quot;</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token literal-property property">worker</span><span class="token operator">:</span> <span class="token string">'先ほどOktaで指定したユーザーのメールアドレス'</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="サンプルの再起動とトンネリング"><a href="#サンプルの再起動とトンネリング" class="header-anchor">#</a> サンプルの再起動とトンネリング</h2> <p>サンプルアプリケーションを再起動し、さらにパブリックインターネットからアクセスできるように<code>ngrok</code>などのツールを使い、トンネリングを行います。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>ngrok http <span class="token number">3000</span>
</code></pre></div><p>無料版のngrokを使用した場合、ランダムな値（例: <code>https://123456.ngrok.io</code>）がURLとして生成されます。この生成されたURLを控えておきます。</p> <p>Frontlineコンソールに戻り、<code>Callbacks</code>画面を開きます。下記の2つのフィールドに値を設定します。</p> <table><thead><tr><th>名前</th> <th>値</th></tr></thead> <tbody><tr><td>CRM Callback URL</td> <td>ngrokのURL<code>/callbacks/crm</code></td></tr> <tr><td>CRM Callback URL</td> <td>ngrokのURL<code>/callbacks/outgoing-conversation</code></td></tr></tbody></table> <p><img src="/superclass-jp-feb-2022/assets/img/frontline-integration-urls.35b53d07.png" alt="frontline - callbacks"></p> <p>これでテキストメッセージが使えるようになりました。</p> <h2 id="音声通話を有効化"><a href="#音声通話を有効化" class="header-anchor">#</a> 音声通話を有効化</h2> <p>初期状態では音声通話が無効化されているため、<code>Voice Calling</code>画面を開き、有効化します。この際、Frontlineで使用するTwilio番号の設定において着信時にFrontline用のTwiML Appが処理を行うように定義する必要があります。</p> <p><img src="/superclass-jp-feb-2022/assets/img/frontline-voice-calling.59c536fe.png" alt="Voice calling"></p> <p>今回はSMSの受信、発信に利用しているTwilio番号に設定します。電話番号の設定画面において<code>CONFIGURE WITH</code>に<code>TwiML App</code>と指定し、<code>TWIML APP</code>には自動的に構築された<code>Voice in Frontline</code>を指定します。下記のスクリーンショットを参考にしてください。</p> <p><img src="/superclass-jp-feb-2022/assets/img/phone-number-twiml-app.00f2083c.png" alt="Voice settings"></p> <h2 id="twilio-frontlineをインストールし、テストを実施"><a href="#twilio-frontlineをインストールし、テストを実施" class="header-anchor">#</a> Twilio Frontlineをインストールし、テストを実施</h2> <p>全ての設定が完了しました。<a href="https://apps.apple.com/app/id1541714273" target="_blank" rel="noopener noreferrer">App Store<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>または<a href="https://play.google.com/store/apps/details?id=com.twilio.frontline" target="_blank" rel="noopener noreferrer">Google PLay Store<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>からTwilio Frontlineをインストールし、起動します。</p> <p>起動時に<code>workspace ID</code>を求められます。先ほど設定した値を入力します。</p> <p><img src="/superclass-jp-feb-2022/assets/img/frontline-app-workspace-id.2553d786.jpg" alt="frontline - workspace ID"></p> <p>次に設定したアイデンティティプロバイダーのサインイン画面が表示されます。</p> <p><img src="/superclass-jp-feb-2022/assets/img/frontline-app-sso.2a17feda.jpg" alt="frontline - SSO"></p> <p>サインインが完了すると会話の一覧画面が表示されます。<code>My Customers</code>タブを開いて先ほど定義したテスト顧客が表示されていることを確認してください。</p> <p><img src="/superclass-jp-feb-2022/assets/img/frontline-app-customers.9267f1f5.jpg" alt="frontline - customers"></p> <p>テスト顧客をタップすると詳細情報が表示されます。VoiceまたはSMSをタップし、実際にメッセージが送信されること、あるいは通話ができることを確認します。</p> <p><img src="/superclass-jp-feb-2022/assets/img/frontline-app-customer-detail.231a1c6e.jpg" alt="Frontline - customer details"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/superclass-jp-feb-2022/labs/03-twilio-frontline/sso.html" class="prev">
        Oktaを使用したSSOの設定
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/superclass-jp-feb-2022/assets/js/app.a35e8044.js" defer></script><script src="/superclass-jp-feb-2022/assets/js/2.1599b906.js" defer></script><script src="/superclass-jp-feb-2022/assets/js/7.4ce9bd8d.js" defer></script>
  </body>
</html>
