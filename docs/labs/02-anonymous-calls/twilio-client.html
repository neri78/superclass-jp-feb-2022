<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Twilio Clientを用いた電話番号を利用しない通話の実装 | Superclassハンズオンラボ</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#0263E0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/superclass-jp-feb-2022/assets/css/0.styles.fc464a75.css" as="style"><link rel="preload" href="/superclass-jp-feb-2022/assets/js/app.ff63657e.js" as="script"><link rel="preload" href="/superclass-jp-feb-2022/assets/js/2.1599b906.js" as="script"><link rel="preload" href="/superclass-jp-feb-2022/assets/js/5.4282ad32.js" as="script"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/10.a01eaac8.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/11.0cccab21.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/12.9ad8e0fd.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/13.1871cdee.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/14.479a9754.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/15.7c28645a.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/16.a842cfc9.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/17.87b378b3.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/18.2277d1b2.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/19.3bbbd8be.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/20.33d21f34.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/21.4c48d880.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/22.10337793.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/23.e4ce7515.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/3.d32f29e7.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/4.6696796f.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/6.0a758a65.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/7.4554f806.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/8.d7c18c68.js"><link rel="prefetch" href="/superclass-jp-feb-2022/assets/js/9.d24c3569.js">
    <link rel="stylesheet" href="/superclass-jp-feb-2022/assets/css/0.styles.fc464a75.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/superclass-jp-feb-2022/" class="home-link router-link-active"><!----> <span class="site-name">Superclassハンズオンラボ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Twilio Functionsの活用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>匿名通話の実現</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/" aria-current="page" class="sidebar-link">匿名通話の実現 - はじめに</a></li><li><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-proxy.html" class="sidebar-link">Twilio Proxyの利用</a></li><li><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html" aria-current="page" class="active sidebar-link">Twilio Clientを用いた電話番号を利用しない通話の実装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#コンソールでtwiml-appを作成" class="sidebar-link">コンソールでTwiML Appを作成</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#アクセストークンを生成するために必要なapiキーとapiシークレットを生成" class="sidebar-link">アクセストークンを生成するために必要なAPIキーとAPIシークレットを生成</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#twilio-functionsに環境変数を設定" class="sidebar-link">Twilio Functionsに環境変数を設定</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#アクセストークンを生成するfunctionを作成" class="sidebar-link">アクセストークンを生成するFunctionを作成</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#twilio-clientの識別子を取得" class="sidebar-link">Twilio Clientの識別子を取得</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#voicegrantの設定" class="sidebar-link">VoiceGrantの設定</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#アクセストークンを生成し、voicegrantを割り当て" class="sidebar-link">アクセストークンを生成し、VoiceGrantを割り当て</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#アクセストークンをレスポンスとして送信" class="sidebar-link">アクセストークンをレスポンスとして送信</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#twiml-appの発着信機能を実装" class="sidebar-link">TwiML Appの発着信機能を実装</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#twiml-appの設定" class="sidebar-link">TwiML Appの設定</a></li><li class="sidebar-sub-header"><a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-client.html#クライアント側アプリケーションの配備" class="sidebar-link">クライアント側アプリケーションの配備</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Twilio Frontlineの体験</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="twilio-clientを用いた電話番号を利用しない通話の実装"><a href="#twilio-clientを用いた電話番号を利用しない通話の実装" class="header-anchor">#</a> Twilio Clientを用いた電話番号を利用しない通話の実装</h1> <p>このセクションでは<a href="">Twilio Client</a>を用いたブラウザーフォンを実装し、匿名通話を実装します。Twilio Clietnは通常の電話番号への発着信も可能なため、厳密には匿名通話専用の機能ではありません。ただし、<code>Client ID</code>を用いてブラウザーフォン同士が通話できるため、結果として電話番号が不要となります。</p> <p><strong>目次</strong></p><div class="table-of-contents"><ul><li><a href="#コンソールでtwiml-appを作成">コンソールでTwiML Appを作成</a></li><li><a href="#アクセストークンを生成するために必要なapiキーとapiシークレットを生成">アクセストークンを生成するために必要なAPIキーとAPIシークレットを生成</a></li><li><a href="#twilio-functionsに環境変数を設定">Twilio Functionsに環境変数を設定</a></li><li><a href="#アクセストークンを生成するfunctionを作成">アクセストークンを生成するFunctionを作成</a></li><li><a href="#twilio-clientの識別子を取得">Twilio Clientの識別子を取得</a></li><li><a href="#voicegrantの設定">VoiceGrantの設定</a></li><li><a href="#アクセストークンを生成し、voicegrantを割り当て">アクセストークンを生成し、VoiceGrantを割り当て</a></li><li><a href="#アクセストークンをレスポンスとして送信">アクセストークンをレスポンスとして送信</a></li><li><a href="#twiml-appの発着信機能を実装">TwiML Appの発着信機能を実装</a></li><li><a href="#twiml-appの設定">TwiML Appの設定</a></li><li><a href="#クライアント側アプリケーションの配備">クライアント側アプリケーションの配備</a></li></ul></div><p></p> <h2 id="コンソールでtwiml-appを作成"><a href="#コンソールでtwiml-appを作成" class="header-anchor">#</a> コンソールでTwiML Appを作成</h2> <p><a href="https://www.twilio.com/console/voice/twiml/apps" target="_blank" rel="noopener noreferrer">Programmable Voiceコンソール<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>のTwiMLセクションを開き、<code>Create new TwiML App</code>ボタンをクリックします。</p> <p><img src="/superclass-jp-feb-2022/assets/img/twiml-app-list.094f4933.png" alt="TwiML App"></p> <p><code>FRIENDLY NAME</code>にわかりやすい名前を入れ、それ以外は空欄のまま、<code>Create</code>ボタンをクリックします。</p> <p><img src="/superclass-jp-feb-2022/assets/img/twiml-app-create.ab7b6bf3.png" alt="TwiML App - Create"></p> <p>作成後、TwiML Appの一覧が表示されるので先ほど作成したAppの名前をクリックし、詳細画面を表示します。</p> <p>画面に表示される<code>SID</code>を控えておきます。</p> <p><img src="/superclass-jp-feb-2022/assets/img/twiml-app-sid.adb785b7.png" alt="TwiML App - SID"></p> <p>このTwiML Appはのちほど利用します。</p> <h2 id="アクセストークンを生成するために必要なapiキーとapiシークレットを生成"><a href="#アクセストークンを生成するために必要なapiキーとapiシークレットを生成" class="header-anchor">#</a> アクセストークンを生成するために必要なAPIキーとAPIシークレットを生成</h2> <p>今回実装するブラウザーフォンはエンドユーザーの端末で利用されます。そのため、Twilioのサービスを利用する場合は<code>Account SID</code>や<code>Auth Token</code>ではなく、サーバーアプリケーション側で<code>アクセストークン</code>を生成し、そちらを利用しなければいけません。</p> <p>ここではサーバーアプリケーションで利用する<code>APIキー</code>および<code>APIシークレット</code>を生成します。</p> <p>コンソールの右上に表示されている<code>Account</code>メニューから<code>API keys &amp; tokens</code>を選択します。</p> <p><img src="/superclass-jp-feb-2022/assets/img/console-menu.2eafef3a.png" alt="Accountメニュー"></p> <div class="custom-block tip"><p class="custom-block-title">情報</p> <p>APIキー、APIシークレットのような重要な情報にアクセスする場合、本人であることを再度確認するため、アカウントに登録されているメールアドレスに認証コードが送信されます。送られてきたコードを入力し、<code>Verify</code>ボタンをクリックします。</p></div> <p>認証後に表示される画面で<code>Create API key</code>ボタンをクリックします。</p> <p><img src="/superclass-jp-feb-2022/assets/img/console-apikey-menu.3d6b286d.png" alt="コンソール - 認証情報画面"></p> <p><code>Friendly name</code>にわかりやすい名前をつけ、その他の項目は初期値のままとし、<code>Create API Key</code>ボタンをクリックしAPIキーを作成します。</p> <p><img src="/superclass-jp-feb-2022/assets/img/console-apikey-create.4015d920.png" alt="コンソール - APIキーの作成"></p> <p>APIキーとその<code>SID</code>、<code>Secret</code>が作成されます。それぞれの情報を控えてください。</p> <p><img src="/superclass-jp-feb-2022/assets/img/console-apikey-info.cf6a4af8.png" alt="コンソール - APIキーの情報"></p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p><code>Secret</code>はこの画面でのみ表示され、閉じると再度確認する方法がありません。正しく値を控えてください。また、この情報を用いてTwilio APIにアクセス可能できるため取り扱いには十分注意してください。</p></div> <h2 id="twilio-functionsに環境変数を設定"><a href="#twilio-functionsに環境変数を設定" class="header-anchor">#</a> Twilio Functionsに環境変数を設定</h2> <p>今回はサーバーアプリケーションに相当する機能をTwilio Functionsを用いて実装します。先ほどのハンズオンで作成したサービスのUIエディターを開き、画面下部に表示されている、<code>Environment Variables</code>をクリックします。</p> <p><img src="/superclass-jp-feb-2022/assets/img/functions-editor-env.c36cc400.png" alt="Twilio Functions UIエディター"></p> <p>この画面で環境変数を追加します。先ほど控えた情報をもとに下記のキーを持つ環境変数を追加します。</p> <table><thead><tr><th>キー名</th> <th>値</th></tr></thead> <tbody><tr><td>TWIML_APP_SID</td> <td>TwiML Appを作成した際に生成されたSIDの値</td></tr> <tr><td>API_KEY</td> <td>API Key SIDの値</td></tr> <tr><td>API_SECRET</td> <td>API Key Secretの値</td></tr></tbody></table> <p>追加した画面は下記のようになります。<code>Add my Twilio Credentials (ACCOUNT_SID) and (AUTH_TOKEN) to ENV</code>にチェックが入っていることも確認してください。</p> <p><img src="/superclass-jp-feb-2022/assets/img/functions-editor-add-env.04a12f55.png" alt="Twilio Functions UIエディター - 環境変数"></p> <h2 id="アクセストークンを生成するfunctionを作成"><a href="#アクセストークンを生成するfunctionを作成" class="header-anchor">#</a> アクセストークンを生成するFunctionを作成</h2> <p>Functionを1つ作成し、PathとVisibilityそれぞれ次のようにします。</p> <table><thead><tr><th>名前</th> <th>値</th></tr></thead> <tbody><tr><td>Path</td> <td>voice-token</td></tr> <tr><td>Visibility</td> <td>Public</td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>Visibilityを<code>Public</code>と指定した場合は外部からのリクエストを全て許可することになります。アクセストークンとアカウントが保持しているTwilio番号を使うと音声通話の発信・着信が可能となるため、トークン発行の前に認証する、トークンの生存期間を利用目的に影響を及ぼさない範囲で可能な限り短くする、などの対策が必要となります。</p></div> <h2 id="twilio-clientの識別子を取得"><a href="#twilio-clientの識別子を取得" class="header-anchor">#</a> Twilio Clientの識別子を取得</h2> <p>Twilio Clientを利用する場合、識別子が必要となります。今回はリクエストから取得するため、<code>/voice-token</code>パスの実装を下記に変更します。</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// クライアントの識別子をリクエストから取得</span>
  <span class="token keyword">const</span> identity <span class="token operator">=</span> event<span class="token punctuation">.</span>identity<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>本番の開発ではこのidentityが一意の値となるようにロジックを追加してください。</p> <h2 id="voicegrantの設定"><a href="#voicegrantの設定" class="header-anchor">#</a> VoiceGrantの設定</h2> <p>続けて、<code>TWIML_APP_SID</code>を外部発信のアプリケーション SIDとし、着信も許可（<code>incomingAllow: true</code>）としたVoiceGrantオブジェクトを作成します。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// クライアントの識別子をリクエストから取得</span>
  <span class="token keyword">const</span> identity <span class="token operator">=</span> event<span class="token punctuation">.</span>identity<span class="token punctuation">;</span>
  
  <span class="token comment">//アクセストークン、音声機能の許可（VoiceGrant）を定義</span>
  <span class="token keyword">const</span> AccessToken <span class="token operator">=</span> Twilio<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span>AccessToken<span class="token punctuation">;</span>
  <span class="token keyword">const</span> VoiceGrant <span class="token operator">=</span> AccessToken<span class="token punctuation">.</span>VoiceGrant<span class="token punctuation">;</span>

  <span class="token comment">// 指定したTwiML Appを着信可能な状態で利用できる許可を設定</span>
  <span class="token keyword">const</span> voiceGrant <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoiceGrant</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">outgoingApplicationSid</span><span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token constant">TWIML_APP_SID</span><span class="token punctuation">,</span>
      <span class="token literal-property property">incomingAllow</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="アクセストークンを生成し、voicegrantを割り当て"><a href="#アクセストークンを生成し、voicegrantを割り当て" class="header-anchor">#</a> アクセストークンを生成し、VoiceGrantを割り当て</h2> <p><code>ACCOUNT_SID</code>、<code>API_KEY</code>、<code>API_SECRET</code>、<code>identity</code>を用いてアクセストークンを生成したのち、続けて先ほど作成したVoiceGrantを設定します。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// クライアントの識別子をリクエストから取得</span>
  <span class="token keyword">const</span> identity <span class="token operator">=</span> event<span class="token punctuation">.</span>identity<span class="token punctuation">;</span>
  
  <span class="token comment">//アクセストークン、音声機能の許可（VoiceGrant）を定義</span>
  <span class="token keyword">const</span> AccessToken <span class="token operator">=</span> Twilio<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span>AccessToken<span class="token punctuation">;</span>
  <span class="token keyword">const</span> VoiceGrant <span class="token operator">=</span> AccessToken<span class="token punctuation">.</span>VoiceGrant<span class="token punctuation">;</span>

  <span class="token comment">// 指定したTwiML Appを着信可能な状態で利用できる許可を設定</span>
  <span class="token keyword">const</span> voiceGrant <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoiceGrant</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">outgoingApplicationSid</span><span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token constant">TWIML_APP_SID</span><span class="token punctuation">,</span>
      <span class="token literal-property property">incomingAllow</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// アクセストークンの生成</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccessToken</span><span class="token punctuation">(</span>
      context<span class="token punctuation">.</span><span class="token constant">ACCOUNT_SID</span><span class="token punctuation">,</span>
      context<span class="token punctuation">.</span><span class="token constant">API_KEY</span><span class="token punctuation">,</span>
      context<span class="token punctuation">.</span><span class="token constant">API_SECRET</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">identity</span><span class="token operator">:</span> identity <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// トークンに許可した機能を定義</span>
  token<span class="token punctuation">.</span><span class="token function">addGrant</span><span class="token punctuation">(</span>voiceGrant<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="アクセストークンをレスポンスとして送信"><a href="#アクセストークンをレスポンスとして送信" class="header-anchor">#</a> アクセストークンをレスポンスとして送信</h2> <p>最後に<code>toJwt()</code>メソッドを使用し、コールバックでアクセストークンを送信します。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// クライアントの識別子をリクエストから取得</span>
  <span class="token keyword">const</span> identity <span class="token operator">=</span> event<span class="token punctuation">.</span>identity<span class="token punctuation">;</span>
  
  <span class="token comment">//アクセストークン、音声機能の許可（VoiceGrant）を定義</span>
  <span class="token keyword">const</span> AccessToken <span class="token operator">=</span> Twilio<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span>AccessToken<span class="token punctuation">;</span>
  <span class="token keyword">const</span> VoiceGrant <span class="token operator">=</span> AccessToken<span class="token punctuation">.</span>VoiceGrant<span class="token punctuation">;</span>

  <span class="token comment">// 指定したTwiML Appを着信可能な状態で利用できる許可を設定</span>
  <span class="token keyword">const</span> voiceGrant <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoiceGrant</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">outgoingApplicationSid</span><span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token constant">TWIML_APP_SID</span><span class="token punctuation">,</span>
      <span class="token literal-property property">incomingAllow</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// アクセストークンの生成</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccessToken</span><span class="token punctuation">(</span>
      context<span class="token punctuation">.</span><span class="token constant">ACCOUNT_SID</span><span class="token punctuation">,</span>
      context<span class="token punctuation">.</span><span class="token constant">API_KEY</span><span class="token punctuation">,</span>
      context<span class="token punctuation">.</span><span class="token constant">API_SECRET</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">identity</span><span class="token operator">:</span> identity <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// トークンに許可した機能を定義</span>
  token<span class="token punctuation">.</span><span class="token function">addGrant</span><span class="token punctuation">(</span>voiceGrant<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// コールバック関数でtokenを返す</span>
  <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">token</span><span class="token operator">:</span> token<span class="token punctuation">.</span><span class="token function">toJwt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>Save</code>ボタンで保存後、<code>Deploy All</code>ボタンをクリックしてFunctionをデプロイします。</p> <p>デプロイ後、<code>vocie-token</code>のURLをブラウザで開いてください。その際に<code>identity</code>をリクエスト文字列で指定します。下の例を参考にしてください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>https://xxxx.twilio.io/voice-token?identity<span class="token operator">=</span>neri78
</code></pre></div><p>画面に出力された<code>token</code>の値を<a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">jwt.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>でデコードするとidentityやVoiceGrantの値を確認できます。</p> <p>これでブラウザからTwilioの機能を利用するためのアクセストークンを生成できるようになりました。</p> <h2 id="twiml-appの発着信機能を実装"><a href="#twiml-appの発着信機能を実装" class="header-anchor">#</a> TwiML Appの発着信機能を実装</h2> <p>TwiML Appで発着信が発生した場合のロジックを実装するため、新たに次のFunctionを追加します。VisibilityはTwiML App（Twilio内部）からのみ呼び出されるため、<code>Protected</code>としておきます。</p> <table><thead><tr><th>名前</th> <th>値</th></tr></thead> <tbody><tr><td>Path</td> <td>call</td></tr> <tr><td>Visibility</td> <td>Protected</td></tr></tbody></table> <p><code>/call</code>ではリクエストから渡された情報をもとに発着信を処理するコードを記述します。今回の実装ではTwiML Appからのコールバックに含まれるTwilio Clientの接続先を取得し、接続します。</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// Voice用TwiMLの作成</span>
  <span class="token keyword">const</span> VoiceResponse <span class="token operator">=</span> Twilio<span class="token punctuation">.</span>twiml<span class="token punctuation">.</span>VoiceResponse<span class="token punctuation">;</span>
  <span class="token keyword">const</span> voiceResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoiceResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 接続先を取得</span>
  <span class="token keyword">const</span> to <span class="token operator">=</span> event<span class="token punctuation">.</span>To<span class="token punctuation">;</span>
  
  <span class="token comment">// Dial verbを用いて接続</span>
  <span class="token keyword">const</span> dial <span class="token operator">=</span> voiceResponse<span class="token punctuation">.</span><span class="token function">dial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dial<span class="token punctuation">.</span><span class="token function">client</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> voiceResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>今回は電話番号との接続しないため、サーバー側のロジックは至ってシンプルです。ここで作成した<code>/call</code>のURLを控えておきます。</p> <h2 id="twiml-appの設定"><a href="#twiml-appの設定" class="header-anchor">#</a> TwiML Appの設定</h2> <p>クライアント側を実装する前にTwiML Appと先ほど作成した<code>/call</code>を紐付けます。
<a href="https://www.twilio.com/console/voice/twiml/apps" target="_blank" rel="noopener noreferrer">Programmable Voiceコンソール<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>から先ほど作成したTwiML Appを開き、<code>/call</code>のURLを<code>Request URL</code>に指定します。</p> <p><img src="/superclass-jp-feb-2022/assets/img/twiml-app-request-url.4da5f0da.png" alt="TwiML Appの設定"></p> <h2 id="クライアント側アプリケーションの配備"><a href="#クライアント側アプリケーションの配備" class="header-anchor">#</a> クライアント側アプリケーションの配備</h2> <p>Twilio Clientを利用する場合はクライアント側のアプリケーションを実装する必要があります。今回は時間を短縮するため、あらかじめ実装済みのアプリケーションを使用します。下記のフォルダからアセット一式を取得してください。</p> <ul><li><a href="https://github.com/neri78/superclass-jp-feb-2022/raw/main/assets/browser-phone.zip" target="_blank" rel="noopener noreferrer">ブラウザーフォンクライアント側ファイル一式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>ダウンロードしたファイルを解凍し、Twilio FunctionsのUIエディターから<code>Add +</code> - <code>Upload File</code>を選択します。4つのファイルを全て選択し、Visibilityを<code>Public</code>と設定します。下記のスクリーンショットを参考にしてください。</p> <p><img src="/superclass-jp-feb-2022/assets/img/functions-upload-assets.bf073274.png" alt="Assetのアップロード"></p> <p>アップロード後、デプロイを実行し、<code>/browser-phone.html</code>のURLをブラウザーで開きます。下記のような画面が表示されていればデプロイが完了しています。</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAb4AAAESCAYAAACCU7B8AAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8bAxCDOIMTAxqCfmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsgsrTMiOU5XxNz7iznWsH0rv4CpHgVwpaQWJwPpP0CcmlxQVMLAwJgCZCuXlxSA2B1AtkgR0FFA9hwQOx3C3gBiJ0HYR8BqQoKcgewbQLZAckYi0AzGF0C2ThKSeDoSG2ovCHA7JqcWKYS5G5kbEHAtGaAktaIERDvnF1QWZaZnlCg4AkMpVcEzL1lPR8HIwMiIgQEU5hDVn2+Aw5JRjAMhllPAwGBxm4GBaSZCLPk9A8P2bwwM/P8RYmoVQL4+A8OBKQWJRYlwBzB+YylOMzaCsLm3MzCwTvv//3M4AwO7JgPD3+v////e/v//32UMDMy3gHq/AQAeNWBfGJF4swAAAFZlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA5KGAAcAAAASAAAARKACAAQAAAABAAABvqADAAQAAAABAAABEgAAAABBU0NJSQAAAFNjcmVlbnNob3RF7UnBAAAB1mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj4yNzQ8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NDQ2PC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6VXNlckNvbW1lbnQ+U2NyZWVuc2hvdDwvZXhpZjpVc2VyQ29tbWVudD4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiDUoCAAAB9WSURBVHgB7d0JlBzFfcfx/+yu9pJAtwS6VoiVkMCAMWCD4wcCYjDE4TCJIdgEsMEOQdjIQACH+wqHYyDIxwMe5rADCYd5IUAMCASOCQTsGHhgHSB0Cx2gc3elvSb9q1WPZmZH0q4009U7/a33pJ3p6e7q/lSrf13VPatUOihGQQABBBBAICECVX+aPSchu8puIoAAAgggYJaix8dhgAACCCCQJIGKJO0s+4oAAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3OwsAggggADBxzGAAAIIIJAoAYIvUc3NziKAAAIIEHwcAwgggAACiRIg+BLV3Ows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MLvqqqtcD26//fZz7++991677bbbbPHixXb33XdnGuOBBx5wPbb33nvPpk+fnpme/0K9wRUrVtjIkSPdRwpCBe7LL7/sQvd3v/udVVZW2re+9a2cRa+88kqbMGFCzrTsN+Fy2mYKAggggEBxBMo++C688EIXSsccc4wLmeOOO84NPabTaTd9wYIFdtddd5lC6Pnnn8+ovvXWW65neO2119rVV19ty5Yty3xW6IWC8ayzzrI//vGPdvHFF9vXvvY102+zUKmvr3c/hw8f7n6Gf1VXV4cvu/3U0OiXvvQlGzhwoK1Zs8ZSqVS3eZiAAAIIINB7gbIPPpFoKFMBMmTIELv88stt0aJFTkr33hRQCj395okvf/nLbrpC59xzz3Wvtcyzzz5rr776qmkIs1DRfcABAwa4jy644AK3nscffzwTVsuXL3dDnbfeemuhxQtO031IBbICmtArSMREBBBAYKcEyjr4Zs+ebeeff77ruZ1++unuIZX8oUUF4jnnnGMzZsywN954wx588EF7+umn7e23386AKgh1v66pqSkzLfuFenKHHnqoNTc326mnnmrjx4+3F198MTOLgk9Blv2ATfih7g2GoRlOC3/qPiEFAQQQQKC4AmUdfE899ZR72nLOnDk2adIk17u76KKL3EMqun+mocS1a9c60csuu8wNUWqI8/3337fbb7/dLr30UveZQkuvN2zYUFB/n332cdP10Ex2r27lypVu+ogRI2zz5s323HPPmV5nl5///OfuwZnsabxGAAEEECidQFkHn4Y1dW9vyZIl7o9Crb293V566SV79913napeh+Xmm2+2Aw44wM4880wXiGHwqcenHuG2hjrHjRvnvg5xwgknuPuG4fp0f/CZZ56xN9980/Ui9RUKPQRDQQABBBDwJ1DWwdfa2mrnnXdeplcX/q8FerqypaXFqWc/aTlx4sSCw5Hq8V1zzTWmryXkFw2V7r///vmT3XuF67Y+K7hA3kQNjepp0KOPPjrvE94igAACCOysQFkHn56a1FOWKgo63XvTgyx60jMc6tRTnWHRgySFiu7RHXzwwa5XN3jw4Mwsml/38u688077/ve/n5muFxpe1Vco7rvvvpzp2W+uuOIKd39Rw7D5Rb3MY489lqc682F4jwACCOyiQFkHX2jT2dlpl1xyibvPdvbZZ4eTu/3U1w8efvhh++IX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" alt="Twilio Client"></p> <p>最初のテキストボックスにはTwilio Clientのユーザー名を英数字で入力します。初期化ボタンをクリックすると、内部では先ほど実装したアクセストークン生成Functionにリクエストを送信し、取得したトークンをもとに<code>Twilio.Device</code>の初期化・登録作業を実行しています。</p> <p>下記の部分が該当するコードになります。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 初期化ボタンをクリックした際にアクセストークンを取得し、Twilio.Deviceを初期化する。</span>
initButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> identity <span class="token operator">=</span> identityField<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token comment">// トークンを取得</span>
    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/voice-token?identity=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>identity<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">'Content-Type'</span> <span class="token operator">:</span> <span class="token string">'application/json'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span>token<span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// トークンを用いて初期化</span>
    device <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Twilio<span class="token punctuation">.</span>Device</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    device<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Twilio Clientの準備ができた段階で発信ボタンを有効化</span>
    device<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'registered'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        identityField<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        callButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        connectButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        initButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Twilio Clientの着信時に応答ボタンを有効化</span>
    device<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'incoming'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">incomingCall</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        callButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        connectButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        activeCall <span class="token operator">=</span> incomingCall<span class="token punctuation">;</span>
        <span class="token comment">// 着信通話が完了した時点で、原状復帰</span>
        activeCall<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'disconnect'</span><span class="token punctuation">,</span> callDisconnected<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>初期化が完了するとユーザー名のフィールドが編集無効となり、発信ボタンが有効化されます。</p> <p><img src="data:image/png;base64,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8MILCZ2ysjI79dRT7bOf/aytWbPGNArysMMOS7zvn2zZssWOPvpo++1vf2ubNm1y8/r3kh/HjBljVVVVyZPsl7/8pVVWVtrZZ59tkydPtqamJrv55ptT5uEFAggggED+BYo++DZu3Ghvv/12IrTmzZtnM2fOtJ/85Cc2a9YsGzdunH3mM5+x3/zmN230H3/8cVu4cKENHTrUTj/9dFu2bFmbeTThvvvusyOPPDLxngLzyiuvtClTprhpCxYscCGYmIEnCCCAAAK7TaDog08tr5tuusmeeOIJO/DAA+2II46wG2+80bXgDjroIPf6/vvvt2nTptmSJUvsrrvuSlTGL37xC9die++99+yaa65JTE9/otbgqlWrbNCgQe4tBaEC9y9/+YsL3ddee826detmF198ccqiN9xwg40YMSJlWvILv5y2mYIAAgggkBuBog++K664woXS2LFjXciccMIJruuxtbXVTV+0aJHdeeedphD685//nFB96623XMvwhz/8oX3/+9+35cuXJ97L9ETBeMEFF9g777xj1157rZ1xxhmmv2ahUl1d7R4HDBjgHv3/ysvL/dM2j+oa/dKXvmS9e/e29evXW0lJSZt5mIAAAggg0HGBog8+kagrUwHSt29fmzRpki1evNhJ6dqbAkqhp7888ZWvfMVNV+hccskl7rmWefbZZ+2VV14xdWFmKroO2KNHD/fW5Zdf7tbz2GOPJcJqxYoVrqvztttuy7R4xmm6DqlAVkATehmJmIgAAgh0SqCog2/OnDl22WWXuZbbOeec4wappHctKhAvuugi++lPf2pvvPGGPfzww/b000/bP/7xjwSoglDX6+rq6hLTkp+oJXf44YdbfX29nXnmmTZ8+HCbMWNGYhYFn4IseYCNf1PXBn1o+mn+UdcJKQgggAACuRUo6uB76qmn3GjLuXPn2v777+9ad1dffbUbpKLrZ+pK3LBhgxOdOHGi66JUF+f7779vt99+u1133XXuPYWWnm/evDmj/qhRo9x0DZpJbtWtXr3aTR84cKA1Njbac889Z3qeXO699143cCZ5Gs8RQAABBLpOoKiDT92aura3dOlS96NQa25utpdeeslmz57tVPXcl1tvvdUOOeQQO//8810g+uBTi08twva6OocNG+Zuhzj55JPddUO/Pl0ffOaZZ+zNN990rUjdQqFBMBQEEEAA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" alt="Twilio Client - 初期化完了"></p> <p>もう1枚ブラウザーのタブを開き、別の名前でブラウザーフォンの初期化を実行してください。</p> <p>発信先に別のブラウザータブで指定した名前を入力し、発信ボタンをクリックするとTwiML Appを用いて発信が行われます。この際、TwiML Appに指定したRequest URLが呼び出され、TwiMLに従って接続されます。</p> <p>ハウリングが起きてしまいますが、双方のブラウザーで通話が可能であること、そして、一方の通話を終了した段階でもう一方の通話も終了することを確認してください。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/superclass-jp-feb-2022/labs/02-anonymous-calls/twilio-proxy.html" class="prev">
        Twilio Proxyの利用
      </a></span> <span class="next"><a href="/superclass-jp-feb-2022/labs/03-twilio-frontline/">
        Twilio Frontlineの体験 - はじめに
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/superclass-jp-feb-2022/assets/js/app.ff63657e.js" defer></script><script src="/superclass-jp-feb-2022/assets/js/2.1599b906.js" defer></script><script src="/superclass-jp-feb-2022/assets/js/5.4282ad32.js" defer></script>
  </body>
</html>
